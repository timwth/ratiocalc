<html>
  <head>
    <title>Aspect Ratio Calculator</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg version='1' xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48' enable-background='new 0 0 48 48'%3E%3Cpath fill='%23616161' d='M40,16H8v24c0,2.2,1.8,4,4,4h24c2.2,0,4-1.8,4-4V16z'/%3E%3Cpath fill='%23424242' d='M36,4H12C9.8,4,8,5.8,8,8v9h32V8C40,5.8,38.2,4,36,4z'/%3E%3Cpath fill='%239CCC65' d='M36,14H12c-0.6,0-1-0.4-1-1V8c0-0.6,0.4-1,1-1h24c0.6,0,1,0.4,1,1v5C37,13.6,36.6,14,36,14z'/%3E%3Cg fill='%2333691E'%3E%3Crect x='33' y='10' width='2' height='2'/%3E%3Crect x='29' y='10' width='2' height='2'/%3E%3C/g%3E%3Cpath fill='%23FF5252' d='M36,23h-3c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1h3c0.6,0,1,0.4,1,1v2C37,22.6,36.6,23,36,23z'/%3E%3Cg fill='%23E0E0E0'%3E%3Cpath d='M15,23h-3c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1h3c0.6,0,1,0.4,1,1v2C16,22.6,15.6,23,15,23z'/%3E%3Cpath d='M22,23h-3c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1h3c0.6,0,1,0.4,1,1v2C23,22.6,22.6,23,22,23z'/%3E%3Cpath d='M29,23h-3c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1h3c0.6,0,1,0.4,1,1v2C30,22.6,29.6,23,29,23z'/%3E%3Cpath d='M15,29h-3c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1h3c0.6,0,1,0.4,1,1v2C16,28.6,15.6,29,15,29z'/%3E%3Cpath d='M22,29h-3c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1h3c0.6,0,1,0.4,1,1v2C23,28.6,22.6,29,22,29z'/%3E%3Cpath d='M29,29h-3c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1h3c0.6,0,1,0.4,1,1v2C30,28.6,29.6,29,29,29z'/%3E%3Cpath d='M15,35h-3c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1h3c0.6,0,1,0.4,1,1v2C16,34.6,15.6,35,15,35z'/%3E%3Cpath d='M22,35h-3c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1h3c0.6,0,1,0.4,1,1v2C23,34.6,22.6,35,22,35z'/%3E%3Cpath d='M29,35h-3c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1h3c0.6,0,1,0.4,1,1v2C30,34.6,29.6,35,29,35z'/%3E%3Cpath d='M15,41h-3c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1h3c0.6,0,1,0.4,1,1v2C16,40.6,15.6,41,15,41z'/%3E%3Cpath d='M22,41h-3c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1h3c0.6,0,1,0.4,1,1v2C23,40.6,22.6,41,22,41z'/%3E%3Cpath d='M29,41h-3c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1h3c0.6,0,1,0.4,1,1v2C30,40.6,29.6,41,29,41z'/%3E%3C/g%3E%3Cg fill='%23BDBDBD'%3E%3Cpath d='M36,29h-3c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1h3c0.6,0,1,0.4,1,1v2C37,28.6,36.6,29,36,29z'/%3E%3Cpath d='M36,35h-3c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1h3c0.6,0,1,0.4,1,1v2C37,34.6,36.6,35,36,35z'/%3E%3Cpath d='M36,41h-3c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1h3c0.6,0,1,0.4,1,1v2C37,40.6,36.6,41,36,41z'/%3E%3C/g%3E%3C/svg%3E" />
    <style>
      body {
        background: #222;
        color: #31c6ef;
        font-family: 'Lucida Sans', 'Lucida Sans Regular', 'Lucida Grande', 'Lucida Sans Unicode', Geneva, Verdana, sans-serif;
        line-height: 32pt;
      }
      input {
        font-family: 'Lucida Sans', 'Lucida Sans Regular', 'Lucida Grande', 'Lucida Sans Unicode', Geneva, Verdana, sans-serif;
        background: #444;
        color: #fff;
        text-align: right;
        border:none;
        padding:4px;
      }
      .content {
        width: fit-content;
        text-align: left;
        min-width: fit-content;
        margin: 32px auto 0 auto;
        padding: 16px;
      }
      .quote {
        font-weight: bold;
        font-size: x-large;
        color: white;
      }
      .calculated {
        color: #96e4f9
      }
      sup.hint {
        color: #fff;
      }
      p.hint {
        font-size: small;
        padding:
      }
    </style>
  </head>
<body>
  <form name="calc">
    <div class="content">
      <p>
        <span class="quote">&ldquo;</span>
        An image in the dimensions of 
        <input type="text" id="input_width" size="4"  value="3200">
        x
        <input type="text" id="input_height" size="4" value="2400">
        with a size of 
        <input type="text" id="pixels" size="8" value="">
        pixels
      <br>
        and an aspect ratio of
        <input type="text" id="ratio" size="5" value="">
        is being shrinked.
      <br>
        A limited size defined by 
        <input type="text" size="5" id="target_width" value="512"> x
        <input type="text" size="5" id="target_height" value="768"> <sup class="hint">*</sup> -
        that's <input type="text" size="8" id="target_pixels" value="325000"> pixels -
        should not be exceeded.
      <br>
        The new image dimensions are 
        <input type="text" size="4" id="width">
        x
        <input type="text" size="4" id="height">;
        divisible by  <input type="text" size="2" id="mod" value="8">, that is
        <input type="text" size="4" id="mod_width">
        x
        <input type="text" size="4" id="mod_height">.
      <br>
        The final size is
        <span id="output_pixels"  class="calculated"></span> pixels,
        <span id="less_more"  class="calculated"></span> compared to the limit.
      <br>
        That is <span id="size_percent" class="calculated"></span> % of the original size
        with a ratio of <span id="output_ratio"  class="calculated"></span>.
        <span class="quote">&rdquo;</span>
      </p>
      <p>&nbsp;</p>
      <p class="hint">
       Hint: changing values will update subsequent values, not any previous values.
       <br>
       <sup class="hint">*</sup> the aspect ratio of the target area is not considered but here to calculate the size based on these dimensions.
      </p>
    </div>
  </form>
  <script>
    el('input_width').onchange = pixelsAndRatio;
    el('input_height').onchange = pixelsAndRatio;
    el('ratio').onchange = widthAndHeight;
    el('target_width').onchange = targetPixels;
    el('target_height').onchange = targetPixels;
    el('target_pixels').onchange = widthAndHeight;
    el('width').onchange = widthChanged;
    el('height').onchange = heightChanged;
    el('mod').onchange = modDimensions;
    el('mod_width').onchange = outputPixels;
    el('mod_height').onchange = outputPixels;
    targetPixels();
    pixelsAndRatio();

    function el(name) { return document.getElementById(name); }
    function get(name) { return el(name).value; }
    function set(name, value) { el(name).value = value; }

    function targetPixels() {
      set('target_pixels', parseInt(get('target_width'))*parseInt(get('target_height')));
      pixelsAndRatio();
    }

    function pixelsAndRatio() {
      set('pixels',parseInt(get('input_width'))*parseInt(get('input_height')));
      set('ratio', Math.floor(parseInt(get('input_width'))/parseInt(get('input_height'))*1000)/1000);
      widthAndHeight();
    }

    function widthAndHeight() {
      const pixels = parseInt(get('target_pixels'));
      const ratio = parseFloat(get('ratio'));
      const width = Math.floor(Math.sqrt(pixels*ratio));
      const height = Math.floor(pixels/width);
      set('width', Math.floor(width));
      set('height', Math.floor(height));
      modDimensions();
      outputPixels();
    }

    function widthChanged() {
      const m = parseInt(get('mod'));
      set('height', Math.floor(parseInt(get('target_pixels'))/parseInt(get('width'))/m)*m);
      modDimensions();
      outputPixels();
    }

    function heightChanged() {
      const m = parseInt(get('mod'));
      set('width', Math.floor(parseInt(get('target_pixels'))/parseInt(get('height'))/m)*m);
      modDimensions();
      outputPixels();
    }

    function modDimensions() {
      const m = parseInt(get('mod'));
      const width = parseInt(get('width'));
      const pixels = parseInt(get('target_pixels'));
      const mod_width = Math.floor(width/m)*m;
      const mod_height = Math.floor(pixels/mod_width/m)*m;
      set('mod_width', mod_width);
      set('mod_height', mod_height);
      outputPixels();
    }

    function outputPixels() {
      const nf = new Intl.NumberFormat();
      const width = parseInt(get('mod_width'));
      const height = parseInt(get('mod_height'));
      el('output_ratio').innerHTML = Math.floor(width/height*1000)/1000;
      const outputPixels = width*height;
      el('output_pixels').innerHTML = nf.format(outputPixels);
      const diff = outputPixels-parseInt(get('target_pixels'));
      el('less_more').innerHTML = diff === 0 ? 'same' : nf.format(Math.abs(diff))+' '+(diff<0 ? 'less' : 'more');
      el('size_percent').innerHTML = Math.floor(parseInt(outputPixels)/parseInt(get('pixels'))*100000)/1000;
    }
  </script>
</body>
</html>